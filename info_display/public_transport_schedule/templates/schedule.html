<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Public Transport Schedule | Info Display</title>
    <link rel="stylesheet" href="/static/css/pts.css" >
  </head>
  <body>
    <h1 id="title">Verbindungen</h1>
	<div id="outer-container">
	  <div id="inner-container">
        <ul id="public-transport-schedule"></ul>
      </div>
	</div>

	<script src="/static/jquery-2.1.3.min.js"></script>
	<script src="/static/date-de-DE.js"></script>
    <script>
    function showError(msg) {
		$("#public-transport-schedule").append($("<li>").addClass("error")
			.text(msg));
    }
    $(function() {
      $.ajax({
        type: "GET",
        url: "schedule.json",
      }).done(function(data) {
		$("#title").append(
			document.createTextNode(" von \"" + data[0].station_name + "\""));
		if (data.length == 0) showError("Keine Verbindungen gefunden.");
        $.each(data, function (index, connection) {
		  // generate date string
          var connection_date = new Date(connection.date);
		  var tomorrow = new Date.today().add(1).day();
          var date_str = connection_date.toString("HH:mm");
		  if (connection_date.getDayName() == tomorrow.getDayName()) {
            date_str = "morgen, " + date_str;
		  }

		  // append new schedule line
		  var newLi = $("<li>");
		  newLi.append(date_str);
		  newLi.append($("<span>").append(" " + connection.line + " ")
			.addClass("numberCircle"));
		  newLi.append(connection.direction + " ("
			+ connection.transport_type + ")");
          $("#public-transport-schedule").append(newLi);
        });
      }).fail(function() {
        showError("Fehler beim Laden des Plans");
      });
    });
    </script>
  </body>
</html>
