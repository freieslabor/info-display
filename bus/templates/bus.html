<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bus Schedule | Info Display</title>
    <link rel="stylesheet" href="/static/css/bus.css" >
  </head>
  <body>
    <h1>NÃ¤chste Busse</h1>
	<div id="outer-container">
	  <div id="inner-container">
        <ul id="bus-schedule"></ul>
      </div>
	</div>

	<script src="/static/jquery-2.1.3.min.js"></script>
	<script src="/static/date-de-DE.js"></script>
    <script>
    function showError(msg) {
		$("#bus-schedule").append($("<li>").addClass("error").text(msg));
    }
    $(function() {
      $.ajax({
        type: "GET",
        url: "schedule.json",
      }).done(function(data) {
		if (data.length == 0) showError("Keine Verbindungen gefunden.");
        $.each(data, function (index, bus) {
		  // generate date string
          var bus_date = new Date(bus.date);
		  var tomorrow = new Date.today().add(1).day();
          var date_str = bus_date.toString("HH:mm");
		  if (bus_date.getDayName() == tomorrow.getDayName()) {
            date_str = "morgen, " + date_str;
		  }

		  // append new schedule line
		  var newLi = $("<li>");
		  newLi.append(date_str);
		  newLi.append($("<span>").append(bus.line).addClass("numberCircle"));
		  newLi.append(bus.direction + " (" + bus.transport_type + ")");
          $("#bus-schedule").append(newLi);
        });
      }).fail(function() {
        showError("Fehler beim Lades des Busplans");
      });
    });
    </script>
  </body>
</html>
